이 글은 (주)넥스트스텝의 류성현 강사님이 진행하시는 ATDD, 클린 코드 with Spring 강의 자료를 정리한 내용입니다.

강의 링크: (https://edu.nextstep.camp/s/c30VOHNP)

--- 

2주차 - ATDD + TDD

단위 테스트란?
- 작은 코드 조각을 검증
- 빠르게 수행 가능
- 격리된 방식으로 처리

통합과 고립(Sociable and Solitary)
- 협력 객체를 실제 객체로 사용하는지 Mock(가짜) 객체로 사용하는지에 따라 테스트 구현이 달라진다.

Test Double
- 실제 객체 대신 사용되는 모든 종류의 객체에 대한 일반 용어
- 즉, 실제(예: 클래스, 모듈 또는 함수)를 가짜 버전으로 대체한다는 의미

협력객체를 실제 객체로? 가짜 객체로?
- 실제 객체를 사용 하면 협력 객체의 행위를 협력 객체 스스로가 정의
- 가짜 객체를 사용하면 협력 객체의 행위를 테스트가 정의

가짜 객체(테스트 더블)를 사용할 경우
- 테스트 대상을 검증할 때 외부 요인(협력 객체)으로 부터 철저희 격리
- 하지만 테스트가 협력 객체의 상세 구현을 알아야 한다.

실제 객체를 사용할 경우
- 실제 객체를 사용할 경우 협력 객체의 상세 구현에 대해서 알 필요가 없다.
- 하지만 협력 객체의 정상 동작여부에 영향을 받는다.

테스트 코드를 작성할 때
- 가짜 객체를 활용하면 실제 객체를 사용할 때 보다 조금 더 편하게 테스트를 작성할 수 있다.
- 하지만 상세 구현에 의존하는 테스트가 될 수 있다.

---

### Classist vs Mockist
- 작은 코드 조각을 검증
- 빠르게 수행 가능
- 격리된 방식으로 처리

*격리된 방식
-테스트 대상과 협력 객체간의 격리
-테스트와 테스트간의 격리

Classist의 단위 테스트
- 테스트를 격리해야하는 대상은 코드가 아니라 또 다른 테스트
- 테스트 간의 공유하는 의존성이 아니라면 실제 객체를 사용

Mockist의 단위 테스트
- 테스트 대상을 협력객체로부터 격리하기 위해 테스트 대상이 의존하는 모든것을 가짜 객체로 대체
- 따라서 Line과 Station이 모두 잘 동작하는지 검증한다는 것은 단위와 단위의 통합이 잘 동작하는지를 검증하는것

---

TDD Approach
- Outside In
- Inside Out

Outside In이란?
- 상위레벨 테스트부터 시작
- 테스트 더블을 활용하여 테스트 대상이 의존하는 협력 객체의 예상 결과를 정의
- 다음 사이클로 테스트 더블로 미리 정의한 협력 객체를 테스트 대상으로 함

장단점
- OO와 TDD가 익숙하지 않은 사람들에게 가이드할 때 도움이 된다
- 도메인에 대한 이해도가 높지 않은 상태에서 진행이 가능하다
- 상대적으로 프로덕션 코드에 의존적인 테스트가 작성된다.(깨지기 쉬운 테스트)

Inside Out
- 실제 객체를 다뤄야 하기 때문에 도메인 모델을 시작
- 의존하는 협력 객체가 실제 존재해야 테스트를 작성할 수 있음

장단점
- 도메인 설계가 충분히 이루어진 다음 진행 가능
- TDD 사이클을 이어나가기가 상대적으로 어렵다
- 프로덕션 코드에 덜 의존적인 테스트가 작성된다.

추천방법
- Top-Down으로 방향을 잡고, Bottom-Up으로 구현한다.
- 인수테스트 작성을 통해 요구사항과 기능 전반에 대한 이해를 선행한다.
- 내부 구현에 대한 설계 흐름을 구상한다.
- 설계가 끝나면 도메인부터 차근차근 TDD로 기능 구현
- 만약 도메인이 복잡하거나 설계가 어려울 경우 이해하고 있는 부분부터 기능을 구현한다.

